/*********************************************************************************************************************
 * COPYRIGHT NOTICE
 * Copyright (c) 2020,逐飞科技
 * All rights reserved.
 * 技术讨论QQ群：一群：179029047(已满)  二群：244861897(已满)  三群：824575535
 *
 * 以下所有内容版权均属逐飞科技所有，未经允许不得用于商业用途，
 * 欢迎各位使用并传播本程序，修改内容时必须保留逐飞科技的版权声明。
 *
 * @file            irq
 * @company         成都逐飞科技有限公司
 * @author          逐飞科技(QQ790875685)
 * @version         查看doc内version文件 版本说明
 * @Software        MounRiver Studio V1.3
 * @Target core     CH32V103R8T6
 * @Taobao          https://seekfree.taobao.com/
 * @date            2020-12-04
 ********************************************************************************************************************/


#-------------------------------------------------------------------------------------------------------------------
#  @brief      关全局中断
#  @param      void
#  @return     void
#  @since      v1.0
#  Sample usage:               内部使用，用户无需关心
#							   mstatus寄存器中的MIE位清0
#-------------------------------------------------------------------------------------------------------------------
.globl dis_interrupt
dis_interrupt:
#csrrci rd, csr, zimm[4:0]
#将mstatus的后4位清空，并且将mstatus 的值  写入a0中
#mstatus 原本的值为 0x7888，变为0x7880
#a0 = 0x7888
#mstatus中的第11 12位MPP
#00 用户模式  (U)
#01 监管者模式(S)
#11 机器模式  (M) 只有该模式允许使用SCR指令
    csrrci a0, mstatus, 0x8
    ret

#-------------------------------------------------------------------------------------------------------------------
#  @brief      开全局中断
#  @param      void
#  @return     void
#  @since      v1.0
#  Sample usage:               内部使用，用户无需关心
#							   mstatus寄存器中的MIE位置1，切换为用户模式
#-------------------------------------------------------------------------------------------------------------------
.globl en_interrupt
en_interrupt:

#	li t0, 0x1f
#	csrw 0x804, t0

#mstatus寄存器中的MIE位置1，切换为用户模式
   	li t0, 0x6088
   	csrs mstatus, t0
    ret
